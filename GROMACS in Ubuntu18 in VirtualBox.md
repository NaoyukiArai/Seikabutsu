# VirtualBox5.2.14にUbuntu18.04を入れてgromacs-5.0.7を入れる

著者：NaoyukiArai

初版：2018/08/12　改訂二版：2018/10/22


※共有フォルダの設定よりも前に一つでも進めないところがあれば、最初からやり直すこと。

## 1.　VirtualBoxの仮想マシンの新規作成

1. VirtualBoxの新規ボタンをクリックする。

    1. 名前とオペレーティングシステム
        - 「名前」（仮想マシンの名前）を入れる。  
        - 「タイプ」をLinuxにする。  
        - 「バージョン」をUbuntu(64bit)にする。

    2. メモリーサイズ
        - コンピュータのメモリを超えないように値を設定する。

    3. ハードディスク
        - 「仮想ハードディスクを作成する」にチェックを入れる。

    4. ファイルの場所
        - 好きなパスにする。容量の大きなドライブのほうがよい。

    5. ファイルサイズ
        - 設定したファイルの場所のドライブの空き容量を超えないように設定する。

    6. ハードディスクのファイルタイプ
        - VDIに設定する。

    7. 物理ハードディスクにあるストレージ
        - 可変サイズに設定。

2. 新規に作った仮想マシンをダブルクリック。

3. 「起動ハードディスクを選択」で、ホストドライブ'D'をUbuntuのisoファイルに変えて起動。

## 2. Ubuntu初期設定

1. ようこそ
    - 「Ubuntuをインストール」をクリック。

2.  キーボードレイアウト
    - どちらも「日本語（無印）」を選択。
    - 「続ける」をクリック。

3. アップデートと他のソフトウェア
    - 「通常のインストール」、「Ubuntuのインストール中にアップデートをダウンロードする」、「グラフィックスとWi-Fiハードウェアと追加のメディアフォーマットのサードパーティ製ソフトウェアをインストールする」にチェックを入れて、「続ける」をクリック。

4. インストールの種類
    - 「ディスクを削除してUbuntuをインストール」にチェック。
    - 「インストール」をクリック。
    - 「ディスクに変更を書き込みますか？」と出たら、「続ける」をクリック。

5. どこに住んでいますか？
    - 「Tokyo」にする。
    - 「続ける」をクリック。

6. あなたの情報を入力してください。
    - ここはスーパーユーザー（管理者）の情報なので自分の好きなように入れる。
    - 「続ける」をクリック。

## 3. Ubuntu初期設定後の環境構築

1. 「今すぐ再起動する」をクリック。  
※「Please remove the installation medium, then press ENTER:」と出て進まないとき 仮想マシンを閉じて再度開く。このとき、「仮想マシンの電源オフ」にチェックを入れてOKする。

    1. Ubuntuの新機能
        - 「次へ」をクリック。

    2.  Livepatch
        - 「次へ」をクリック。

    3. Ubuntuの改善を支援する
        - 「いいえ、送信しません」にチェックを入れて、「次へ」をクリック。

    4. 準備が完了しました！
       - 「完了」をクリック。

    5. どこに住んでいますか？
       - 「Tokyo」にする。
       - 「続ける」をクリック。

    6. あなたの情報を入力してください。
       - ここはスーパーユーザー（管理者）の情報なので自分の好きなように入れる。
       - 「続ける」をクリック。

2. Launcherの一番下の、「アプリケーションを表示する」をクリックし、「ソフトウェアの更新」を探してクリック。「今すぐインストール」をクリック。

3. 「Ubuntu 18.04のリリース後に、ソフトウェアがアップデートされました。今すぐインストールしますか？」と出たら、「今すぐインストールする」をクリック。

4. インストールが終わったら、「すぐに再起動」をクリック。

5. VirtualBoxの「デバイス」の「共有フォルダ」の「共有フォルダ設定...」を選び、「アクセス権」という文字の右にある「新規共有フォルダを追加します」をクリックする。

6. フォルダのパスとフォルダ名を設定し、「自動マウント」と「永続化する」にチェックを入れる。このとき、容量の大きいドライブに共有フォルダを作るほうがよい。

7. VirtualBoxの「デバイス」から「Guest Additions CDイメージの挿入...」をクリック。

8. このとき、「"VBoxGAs5.2.12"には自動的に起動するソフトウェアが含まれています。実行しますか？」と出るので、それを実行する。

9. 処理が終わるまで待ち、「Press Return to close this window...」とでると、Enterキーを押す。

10. 仮想マシンを閉じて再度開く。このとき、「仮想マシンの電源オフ」にチェックを入れてOKする。

11. デスクトップに、「sf_ユーザー名」が存在することを確認する。

12. デスクトップを右クリックして、「端末を開く」をクリックして端末を開く。

13. sudo suコマンドを入力。

14. 端末にgpasswd -a ユーザー名 vboxsfと打って、共有フォルダを管理者権限なしで開けるようにする。

15. 仮想マシンを閉じて再度開く。このとき、「仮想マシンの電源オフ」にチェックを入れてOKする。

16. デスクトップ上にある「sf_ユーザー名」フォルダが開けることを確認する。

17. ランチャーの「Ubuntuソフトウェア」を開いて、「更新」をクリックし、「ソフトウェアは最新です」と表示されるのを確認する。

## 4. gromacsの導入

1. gromacsをダウンロード（必ずtar.gzを選ぶ）。

2. ランチャーの「ファイル」から「ダウンロード」フォルダを開き、ダウンロードしてきたgromacsファイル2があることを確認して、「ホーム」フォルダに移動する。

3. 右クリックから「ここで展開する」をクリック。

4. 端末を開いて、次のように入力する。  
cd 展開したgromacsのファイルのパス  
mkdir build  
cd build  
sudo apt install cmake

5. この操作後に追加で98.9MBのディスク容量が消費されます。続行しますか？」と出ると、Yを入力しEnterキーを押す。

6. 端末につぎのように入力する。  
sudo apt-get install g++ gfortran  
cmake .. -DGMX_BUILD_OWN_FFTW=ON -DREGRESSIONTEST_DOWNLOAD=ON  
make  
make check  
sudo make install  
cd  
vi .vimrc

7. .vimrcファイルに「set nocompatible」とだけ書く。この操作によって、十字キーを使ってもABCDと打たれなくなる。

8. 端末にvi .bashrcと入力する。

9. 開いた.bashrcファイルの一番最後に、source /usr/local/gromacs/bin/GMXRCとつける。

10. 端末にbashと入力する。

## 5. OpenMPIの導入

1. OpenMPIをダウンロード（必ずtar.gzを選ぶ）。

2. ランチャーの「ファイル」から「ダウンロード」フォルダを開き、ダウンロードしてきたopenmpiファイルがあることを確認して、「ホーム」フォルダに移動する。

3. 右クリックから「ここで展開する」をクリック。

4. 端末を開いて、次のように入力する。  
cd 展開したOpenMPIのファイルのパス  
mkdir build  
cd build  
../configure --prefix=/usr/local/openmpi CC=gcc CXX=g++ F77=gfortran FC=gfortran CFLAGS=-m64 CXXFLAGS=-m64 FCFLAGS=-m64 FFLAGS=-m64  
make all  
sudo make install  
cd  
vi .bashrc

5. 開いた.bashrcファイルの一番最後に、次のように書く。PATH=/usr/local/openmpi/bin:$PATH
LD_LIBRARY_PATH=/usr/local/openmpi/lib:$LD_LIBRARY_PATH
MANPATH=/usr/local/openmpi/share/man:$MANPATH
export PATH LD_LIBRARY_PATH MANPATH

6. 端末にbashと入力する。

初版：2018/08/12  
二版：2018/10/22